---
title: 通过车辆位置数据来统计交通量
date: 2019-06-09 15:00:54
tags: 
- 交通
- 数据处理
categories:
- 项目
---

以往的交通调查往往通过人工方式，在需要调查的交叉口安排调查人员，统计经过的车辆数。费时费力，效率低，成本高。  

现在摄像头运用越来越广，交叉口基本都布设的摄像头。并通过强大的图像识别算法能够记录交叉口的车辆信息，包括车牌号、车型等。也就是说，目前可以获得交叉口所有的车辆信息。

考虑是否可以通过相邻的多个交叉口的信息，按车辆统计每个车的路径，并基于路径来count经过的车辆数，也就是各个路径的交通量。

<!-- more -->

## 原始数据介绍

我拿到手的数据已经经过处理，处理的过程主要是通过软件来对交叉口的路线进行车辆识别，最终导出车辆的交叉口位置表，表结构大致如下。

| ID | plate_no |veh_type|pass_time|c_name|direction|
| --- | --- | --- | --- | --- | --- |
| 001 |车牌A|车型|时间A|交叉口A|朝向|

## 对数据进行预处理

原始数据中存在一些问题，比如车型分类过细，交叉口存在重复命名，朝向存在重复明明，`pass_time`字段为字符串格式等。

1. 将原始数据导入oracle数据库中，注意选择数据类型
2. 利用`replace`，`case when`，`substr`等函数对原始数据进行预处理，并实现时间段的分类  
交通调查一般只取早晚高峰的小时流量。
3. 利用`listagg`函数来实现按车辆统计路径

```sql
listagg(c_name) within group (order by pass_time_ss) c_list
from xxx group by plate_no
```

## 通过路径来计算交叉口流量
